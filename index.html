<!DOCTYPE html>
<html lang="km">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cambodian ID Generator - Pro HD</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kantumruy+Pro:wght@400;700&display=swap');

        body {
            background-color: #d6ccc2;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            font-family: 'Kantumruy Pro', sans-serif;
        }

        .main-wrapper {
            display: flex;
            flex-direction: row;
            align-items: flex-start;
            gap: 25px;
        }

        #id-card {
            width: 600px; 
            height: 380px; 
            background-color: #f5fbe0;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            box-sizing: border-box;
            position: relative;
            overflow: hidden;
        }

        .top-section { display: flex; gap: 20px; height: 215px; }
        
        .left-col { width: 130px; text-align: center; }
        .photo-box {
            width: 125px;
            height: 155px;
            border: 1px solid #aaa;
            background: #fff;
            cursor: pointer;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .photo-box img { width: 100%; height: 100%; object-fit: cover; }

        .sig-container {
            margin-top: 15px;
            width: 125px;
            height: 55px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #sig-display {
            max-width: 110px;
            max-height: 50px;
        }

        .right-col { flex-grow: 1; font-size: 15px; color: #111; line-height: 1.5; }
        .id-num-display { text-align: right; font-size: 24px; font-weight: bold; margin-bottom: 10px; height: 35px; color: #222; }
        
        .row { display: flex; align-items: baseline; margin-bottom: 5px; font-weight: 700; }
        .label { color: #000; margin-right: 8px; white-space: nowrap; }
        .flex { display: flex; justify-content: space-between; }

        input {
            background: transparent;
            border: none;
            font-family: 'Kantumruy Pro', sans-serif;
            font-size: 15px;
            color: #333;
            width: 100%;
        }
        input:focus { outline: none; }
        .bold-text { font-weight: 700 !important; color: #000; font-size: 16px; }

        .divider { height: 2px; background: #000; margin: 12px 0; width: 100%; }

        .mrz-container {
            font-family: 'Courier New', Courier, monospace;
            font-size: 20px; 
            letter-spacing: 6.3px; 
            line-height: 1.1;
            text-transform: uppercase;
            font-weight: bold;
            color: #222;
            margin-top: 10px;
        }
        .mrz-line { display: block; white-space: pre; margin: 0; }
        
        .sidebar {
            width: 220px;
            background: #fff;
            padding: 20px;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        .btn {
            padding: 14px;
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            font-size: 14px;
            transition: 0.2s;
        }
        .btn-random { background: #3b82f6; }
        .btn-save { background: #059669; }
        #imgIn { position: absolute; left: -9999px; }
    </style>
</head>
<body>

<div class="main-wrapper">
    <div id="id-card">
        <div class="top-section">
            <div class="left-col">
                <div class="photo-box" onclick="triggerUpload()">
                    <img id="view-photo" src="" style="display:none;">
                    <span id="upload-txt" style="font-size: 11px; color: #777; padding: 10px;">á…á»á…á‘á¸á“áŸáŸ‡áŠá¾á˜áŸ’á”á¸áŠá¶á€áŸ‹ášá¼á”á—á¶á–</span>
                </div>
                <div class="sig-container">
                    <img id="sig-display" src="">
                </div>
            </div>

            <div class="right-col">
                <div class="id-num-display">
                    <input type="text" id="topID" value="55927000" style="text-align: right; font-weight: bold; font-size: 24px;">
                </div>
                
                <div class="row">
                    <span class="label">á‚áŸ„ááŸ’áá“á¶á˜á“á·á„á“á¶á˜:</span> 
                    <input type="text" id="nameInput" class="bold-text" value="á áŸá„ á”á‰áŸ’á‰á¶ HENG PANHA">
                </div>

                <div class="row flex">
                    <div style="display:flex;">
                        <span class="label">ááŸ’á„áŸƒááŸ‚á†áŸ’á“á¶áŸ†á€áŸ†áá¾á:</span> 
                        <input type="text" id="inputDOB" value="19.12.1993" style="width:90px">
                    </div>
                    <div style="display:flex;">
                        <span class="label">á—áŸá‘:</span> 
                        <input type="text" id="genderInput" value="á”áŸ’ášá»áŸ" style="width:40px">
                    </div>
                    <div style="display:flex;">
                        <span class="label">á€á˜áŸ’á–áŸáŸ‹:</span> 
                        <input type="text" id="heightInput" value="153" style="width:35px">
                    </div>
                </div>

                <div class="row">
                    <span class="label">á‘á¸á€á“áŸ’á›áŸ‚á„á€áŸ†áá¾á:</span> 
                    <input type="text" id="birthPlace" value="á—áŸ’á“áŸ†á–áŸá‰">
                </div>

                <div class="row">
                    <span class="label">á¢á¶áŸá™áŠáŸ’á‹á¶á“:</span> 
                    <input type="text" id="addressInput" value="á—áŸ’á“áŸ†á–áŸá‰, á‘á½á›á‚áŸ„á€">
                </div>

                <div class="row flex">
                    <div style="display:flex;">
                        <span class="label">áŸá»á–á›á—á¶á–:</span> 
                        <input type="text" id="validFrom" value="19.12.2023" style="width:95px">
                    </div>
                    <div style="display:flex;">
                        <span class="label">áŠá›áŸ‹ááŸ’á„áŸƒ:</span> 
                        <input type="text" id="validTo" value="19.12.2033" style="width:95px">
                    </div>
                </div>

                <div class="row">
                    <span class="label">á—á·á“á—á¶á‚:</span> 
                    <input type="text" id="feature" value="á”áŸ’ášá‡áŸ’ášá»á™á…áŸ†. áŸ ,áŸ¥áŸ.á˜ á›á¾á…á·á‰áŸ’á…á¾á˜">
                </div>
            </div>
        </div>

        <div class="divider"></div>

        <div class="mrz-container">
            <div class="mrz-line" id="m1">IDKHM55927000<<<<<<<<<<<<<<<<<</div>
            <div class="mrz-line" id="m2">9312192M3312190KHM<<<<<<<<<<<6</div>
            <div class="mrz-line" id="m3">HENG<<PANHA<<<<<<<<<<<<<<<<<<<<</div>
        </div>
    </div>

</div>
                    
    <div class="sidebar">
        <input type="file" id="imgIn" accept="image/*">
        <button class="btn btn-random" onclick="generateRandom()">ğŸ”„ Random Info</button>
        <button class="btn btn-save" onclick="saveImage()">ğŸ“¥ Download Image</button>
    </div>

<script>
    const districts = ["á…áŸ†á€á¶ášá˜á“", "áŠá¼á“á–áŸá‰", "áŸ§á˜á€ášá¶", "á‘á½á›á‚áŸ„á€", "áŸáŸ‚á“áŸá»á", "á˜á¶á“á‡áŸá™", "á”á¹á„á€áŸá„á€á„"];
    const feats = ["á”áŸ’ášá‡áŸ’ášá»á™á…áŸ†. áŸ ,áŸ¥áŸ.á˜ á›á¾á…á·á‰áŸ’á…á¾á˜", "áŸáŸ’á›á¶á€áŸáŸ’á“á¶á˜á€áŸ’á”áŸ‚ášááŸ’ášá…áŸ€á€", "á”áŸ’ášá‡áŸ’ášá»á™á›á¾á”á”á¼ášá˜á¶ááŸ‹", "á‚áŸ’á˜á¶á“", "áŸáŸ’á›á¶á€áŸáŸ’á“á¶á˜á›á¾ááŸ’á„á¶áŸ"];

    function triggerUpload() { document.getElementById('imgIn').click(); }

    // FUNCTION: LOAD IMAGE AND REMOVE WHITE BACKGROUND
    function loadAndCleanSignature(imgUrl) {
        const img = new Image();
        img.src = imgUrl;
        img.onload = function() {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = img.width;
            canvas.height = img.height;
            ctx.drawImage(img, 0, 0);

            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;

            // Loop through pixels and make white (or near-white) transparent
            for (let i = 0; i < data.length; i += 4) {
                const r = data[i];
                const g = data[i + 1];
                const b = data[i + 2];
                // If the pixel is very light/white, set alpha to 0
                if (r > 200 && g > 200 && b > 200) {
                    data[i + 3] = 0;
                }
            }
            ctx.putImageData(imageData, 0, 0);
            document.getElementById('sig-display').src = canvas.toDataURL();
        };
    }

    function updateMRZ() {
        const id = document.getElementById('topID').value.replace(/\s/g, "").substring(0,9);
        const nameMatch = document.getElementById('nameInput').value.match(/[A-Z\s]+/g);
        const dob = document.getElementById('inputDOB').value.split('.');
        const exp = document.getElementById('validTo').value.split('.');
        const gender = document.getElementById('genderInput').value === "á”áŸ’ášá»áŸ" ? "M" : "F";

        document.getElementById('m1').innerText = `IDKHM${id}`.padEnd(30, '<');
        if(dob.length === 3 && exp.length === 3) {
            const d = dob[2].substring(2) + dob[1] + dob[0];
            const e = exp[2].substring(2) + exp[1] + exp[0];
            document.getElementById('m2').innerText = `${d}2${gender}${e}0KHM<<<<<<<<<<<6`;
        }
        if (nameMatch) {
            let n = nameMatch.join('').trim().replace(/\s+/g, "<<");
            document.getElementById('m3').innerText = n.padEnd(30, '<');
        }
    }

    function saveImage() {
        const card = document.getElementById('id-card');
        html2canvas(card, { 
            scale: 4, 
            useCORS: true,
            backgroundColor: null,
            onclone: (clonedDoc) => {
                const inputs = clonedDoc.getElementById('id-card').querySelectorAll('input');
                inputs.forEach(input => {
                    const span = clonedDoc.createElement('span');
                    span.innerText = input.value;
                    span.style.cssText = window.getComputedStyle(input).cssText;
                    span.style.display = "inline-block";
                    input.parentNode.replaceChild(span, input);
                });
            }
        }).then(canvas => {
            const link = document.createElement('a');
            link.download = 'CLEAN_ID_CARD.png';
            link.href = canvas.toDataURL('image/png', 1.0);
            link.click();
        });
    }

    function generateRandom() {
        const fNames = [{kh: "á áŸá„", en: "HENG"}, {kh: "áŸá»á", en: "SOK"}, {kh: "á…á¶á“áŸ‹", en: "CHAN"}];
        const gNames = [{kh: "á”á‰áŸ’á‰á¶", en: "PANHA"}, {kh: "áŠá¶ášáŸ‰á¶", en: "DARA"}, {kh: "á˜á»á“áŸ’á“á¸", en: "MUNNY"}];
        const f = fNames[Math.floor(Math.random() * fNames.length)];
        const g = gNames[Math.floor(Math.random() * gNames.length)];
        
        document.getElementById('nameInput').value = `${f.kh} ${g.kh} ${f.en} ${g.en}`;
        document.getElementById('topID').value = Math.floor(10000000 + Math.random() * 90000000);
        
        const day = String(Math.floor(Math.random() * 28) + 1).padStart(2, '0');
        const mon = String(Math.floor(Math.random() * 12) + 1).padStart(2, '0');
        const year = Math.floor(Math.random() * (2000 - 1980 + 1)) + 1980;
        
        document.getElementById('inputDOB').value = `${day}.${mon}.${year}`;
        document.getElementById('validFrom').value = `${day}.${mon}.2023`;
        document.getElementById('validTo').value = `${day}.${mon}.2033`;
        document.getElementById('genderInput').value = Math.random() > 0.5 ? "áŸáŸ’ášá¸" : "á”áŸ’ášá»áŸ";
        document.getElementById('heightInput').value = Math.floor(Math.random() * (185 - 150 + 1)) + 150;
        document.getElementById('feature').value = feats[Math.floor(Math.random() * feats.length)];
        document.getElementById('addressInput').value = "á—áŸ’á“áŸ†á–áŸá‰, " + districts[Math.floor(Math.random() * districts.length)];
        
        // Random signature and clean background
        const randomSig = Math.floor(Math.random() * 20) + 1;
        loadAndCleanSignature(`asset/image/${randomSig}.webp`);

        updateMRZ();
    }

    document.getElementById('imgIn').onchange = e => {
        const [file] = e.target.files;
        if (file) {
            const reader = new FileReader();
            reader.onload = (event) => {
                document.getElementById('view-photo').src = event.target.result;
                document.getElementById('view-photo').style.display = 'block';
                document.getElementById('upload-txt').style.display = 'none';
            };
            reader.readAsDataURL(file);
        }
    };

    // Load initial clean signature
    loadAndCleanSignature(`asset/image/1.webp`);
    updateMRZ();
</script>
</body>
</html>

